<launch>
  <!--
    Launch file untuk menjalankan:
    1. MPC Trajectory Follower Manual (control)
    2. Trajectory Publisher Gated (diamond ascending)
    3. Data Logger MAVROS Traj (logging)
    
    Penggunaan:
    roslaunch mpc_offboard mpc_manual_diamond_logging.launch
  -->

  <!-- ==== PARAMETER TRAJECTORY DIAMOND ==== -->
  <arg name="waypoint_mode"          default="diamond"/>
  <arg name="ref_speed"              default="2.0"/>
  <arg name="loop_trajectory"        default="false"/>
  <arg name="start_at_current_pose"  default="true"/>

  <!-- Altitude gate -->
  <arg name="hover_altitude"         default="5.0"/>
  <arg name="alt_tolerance"          default="0.3"/>
  <arg name="hover_stable_time"      default="2.0"/>
  <arg name="gate_on_altitude"       default="true"/>

  <!-- Acceptance / reach detection -->
  <arg name="acceptance_radius_xy"   default="0.8"/>
  <arg name="acceptance_alt_tol"     default="0.5"/>
  <arg name="advance_on_reach"       default="true"/>
  
  <!-- Waypoint follow mode -->
  <arg name="waypoint_follow_mode"   default="true"/>

  <!-- Diamond parameters -->
  <arg name="diamond_center_n"         default="0.0"/>
  <arg name="diamond_center_e"         default="0.0"/>
  <arg name="diamond_size"             default="7.5"/>  <!-- Jarak dari center ke corner (meter) -->
  <!-- NED altitudes (negative = up): start at 5m, end at 10m -->
  <arg name="diamond_start_altitude"   default="-5.0"/>   <!-- -5m NED = 5m above ground -->
  <arg name="diamond_end_altitude"     default="-10.0"/>  <!-- -10m NED = 10m above ground -->
  <arg name="diamond_points_per_side"  default="0"/>     <!-- Jumlah waypoint per sisi (0 = corners only) -->

  <!-- Data logger -->
  <arg name="auto_stop_on_finish"    default="true"/>

  <!-- ==== NODE 1: TRAJECTORY PUBLISHER GATED ==== -->
  <node name="trajectory_publisher_mavros_gated"
        pkg="mpc_offboard"
        type="trajectory_publisher_mavros_gated.py"
        output="screen">
    
    <param name="waypoint_mode"          value="$(arg waypoint_mode)"/>
    <param name="ref_speed"              value="$(arg ref_speed)"/>
    <param name="loop_trajectory"        value="$(arg loop_trajectory)"/>
    <param name="start_at_current_pose"  value="$(arg start_at_current_pose)"/>
    
    <param name="hover_altitude"         value="$(arg hover_altitude)"/>
    <param name="alt_tolerance"          value="$(arg alt_tolerance)"/>
    <param name="hover_stable_time"      value="$(arg hover_stable_time)"/>
    <param name="gate_on_altitude"       value="$(arg gate_on_altitude)"/>
    
    <param name="acceptance_radius_xy"   value="$(arg acceptance_radius_xy)"/>
    <param name="acceptance_alt_tol"     value="$(arg acceptance_alt_tol)"/>
    <param name="advance_on_reach"       value="$(arg advance_on_reach)"/>
    <param name="waypoint_follow_mode"   value="$(arg waypoint_follow_mode)"/>
    
    <param name="diamond_center_n"         value="$(arg diamond_center_n)"/>
    <param name="diamond_center_e"         value="$(arg diamond_center_e)"/>
    <param name="diamond_size"             value="$(arg diamond_size)"/>
    <param name="diamond_start_altitude"   value="$(arg diamond_start_altitude)"/>
    <param name="diamond_end_altitude"     value="$(arg diamond_end_altitude)"/>
    <param name="diamond_points_per_side"  value="$(arg diamond_points_per_side)"/>
  </node>

  <!-- ==== NODE 2: MPC TRAJECTORY FOLLOWER MANUAL ==== -->
  <node name="mpc_trajectory_follower_manual"
        pkg="mpc_offboard"
        type="mpc_trajectory_follower_manual.py"
        output="screen">
  </node>

  <!-- ==== NODE 3: DATA LOGGER MAVROS TRAJ ==== -->
  <node name="data_logger_mavros_traj"
        pkg="mpc_offboard"
        type="data_logger_mavros_traj.py"
        output="screen">
    <!-- Auto stop saat trajectory selesai -->
    <param name="auto_stop_on_finish" value="$(arg auto_stop_on_finish)"/>
  </node>

</launch>
