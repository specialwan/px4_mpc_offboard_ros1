<?xml version="1.0"?>
<launch>
    <!-- 
    Launch file untuk MPC Position-Only Controller dengan Square Trajectory
    - Trajectory publisher HANYA mengirim referensi posisi (tanpa kecepatan)
    - MPC controller cost function HANYA posisi
    -->

    <!-- ===================== TRAJECTORY PARAMS ===================== -->
    <arg name="waypoint_mode" default="square"/>
    <arg name="ref_speed" default="1.0"/>
    <arg name="loop_trajectory" default="false"/>
    <arg name="start_at_current_pose" default="true"/>

    <!-- Hover / gate -->
    <arg name="hover_altitude" default="5.0"/>
    <arg name="alt_tolerance" default="0.3"/>
    <arg name="hover_stable_time" default="2.0"/>
    <arg name="gate_on_altitude" default="true"/>

    <!-- Waypoint acceptance -->
    <arg name="acceptance_radius_xy" default="0.5"/>
    <arg name="acceptance_alt_tol" default="0.3"/>
    <arg name="advance_on_reach" default="true"/>
    <arg name="waypoint_follow_mode" default="true"/>

    <!-- Square params -->
    <arg name="square_center_n" default="0.0"/>
    <arg name="square_center_e" default="0.0"/>
    <arg name="square_size" default="15.0"/>
    <arg name="square_altitude" default="-5.0"/>
    <arg name="square_points_per_side" default="0"/>
    <arg name="square_constant_yaw" default="true"/>

    <arg name="auto_stop_on_finish"    default="true"/>

    <!-- ===================== TRAJECTORY PUBLISHER (POSITION ONLY) ===================== -->
    <node name="trajectory_publisher_position_only" 
          pkg="mpc_offboard" 
          type="trajectory_publisher_position_only.py" 
          output="screen">
        <param name="waypoint_mode" value="$(arg waypoint_mode)"/>
        <param name="ref_speed" value="$(arg ref_speed)"/>
        <param name="loop_trajectory" value="$(arg loop_trajectory)"/>
        <param name="start_at_current_pose" value="$(arg start_at_current_pose)"/>
        
        <param name="hover_altitude" value="$(arg hover_altitude)"/>
        <param name="alt_tolerance" value="$(arg alt_tolerance)"/>
        <param name="hover_stable_time" value="$(arg hover_stable_time)"/>
        <param name="gate_on_altitude" value="$(arg gate_on_altitude)"/>
        
        <param name="acceptance_radius_xy" value="$(arg acceptance_radius_xy)"/>
        <param name="acceptance_alt_tol" value="$(arg acceptance_alt_tol)"/>
        <param name="advance_on_reach" value="$(arg advance_on_reach)"/>
        <param name="waypoint_follow_mode" value="$(arg waypoint_follow_mode)"/>
        
        <param name="square_center_n" value="$(arg square_center_n)"/>
        <param name="square_center_e" value="$(arg square_center_e)"/>
        <param name="square_size" value="$(arg square_size)"/>
        <param name="square_altitude" value="$(arg square_altitude)"/>
        <param name="square_points_per_side" value="$(arg square_points_per_side)"/>
        <param name="square_constant_yaw" value="$(arg square_constant_yaw)"/>
        
        <param name="rate" value="50.0"/>
    </node>

    <!-- ===================== MPC POSITION-ONLY CONTROLLER ===================== -->
    <node name="mpc_position_only" 
          pkg="mpc_offboard" 
          type="mpc_position_only.py" 
          output="screen">
    </node>

    <!-- ==== NODE 3: DATA LOGGER MAVROS TRAJ ==== -->
    <node name="data_logger_mavros_traj"
            pkg="mpc_offboard"
            type="data_logger_mavros_traj.py"
            output="screen">
        <!-- Auto stop saat trajectory selesai -->
        <param name="auto_stop_on_finish" value="$(arg auto_stop_on_finish)"/>
    </node>

</launch>
